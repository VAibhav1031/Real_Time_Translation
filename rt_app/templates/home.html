
{% extends "layout.html" %}
{% block content %}

<h3>Start a Conversation</h3>

<div style="display:flex; gap:10px; margin-bottom:20px;">
    <button id="createBtn" class="primary" onclick="setMode('create')">Create Room</button>
    <button id="joinBtn" class="secondary" onclick="setMode('join')">Join Room</button>
</div>

<form action="/join" method="POST" id="joinForm">
    {{ form.hidden_tag() }}

    <div id="roomSection">
        <label>Room ID</label>
        <input type="text" name="room" id="roomInput" placeholder="Enter room ID" required>
    </div>

    
    <label>Select Role</label>
    <select name="role" id="roleInput" required>
        <option value="doctor">Doctor</option>
        <option value="patient">Patient</option>
    </select>

    <label>Your Language</label>
    <select name="language" id="langInput" required>
        <option value="en">English</option>
        <option value="hi">Hindi</option>
        <option value="es">Spanish</option>
        <option value="fr">French</option>
    </select>

    <br><br>
    <button type="submit" class="primary" id="submitBtn">Join Chat</button>
</form>

<p class="chat-meta" id="helperText">
    Join an existing conversation using a shared Room ID.
</p>

<script>
let mode = "join";

function setMode(selected) {
    mode = selected;

    const roomInput = document.getElementById("roomInput");
    const helper = document.getElementById("helperText");
    const submitBtn = document.getElementById("submitBtn");

    document.getElementById("createBtn").className = selected === "create" ? "primary" : "secondary";
    document.getElementById("joinBtn").className = selected === "join" ? "primary" : "secondary";

    if (selected === "create") {
        const id = Math.random().toString(36).substring(2, 8);
        roomInput.value = id;
        roomInput.readOnly = true;
        helper.innerText = "A new Room ID has been generated. Share it with the other participant.";
        submitBtn.innerText = "Create & Enter Chat";
    } else {
        roomInput.value = "";
        roomInput.readOnly = false;
        helper.innerText = "Join an existing conversation using a shared Room ID.";
        submitBtn.innerText = "Join Chat";
    }
}

// default mode
setMode("join");
</script>

{% endblock %}

